{"remainingRequest":"E:\\QuanLyDaoTao\\Front-end\\node_modules\\babel-loader\\lib\\index.js!E:\\QuanLyDaoTao\\Front-end\\src\\app\\state\\ducks\\session\\reducers.js","dependencies":[{"path":"E:\\QuanLyDaoTao\\Front-end\\src\\app\\state\\ducks\\session\\reducers.js","mtime":1556268833713},{"path":"E:\\QuanLyDaoTao\\Front-end\\.babelrc","mtime":1554785266000},{"path":"E:\\QuanLyDaoTao\\Front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\QuanLyDaoTao\\Front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["var _createReducer;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { combineReducers } from \"redux\";\nimport * as types from \"./types\";\nimport * as utils from './utils';\nimport { createReducer } from \"../../utils\";\nimport { history } from '../../utils';\nimport jwtDecode from 'jwt-decode';\nvar user = localStorage.getItem('user');\nvar initialState = user ? {\n  loggedIn: true,\n  user: user\n} : {};\nvar authReducer = createReducer(initialState)((_createReducer = {}, _defineProperty(_createReducer, types.LOGIN, function (state, action) {\n  return {\n    loggedIn: false,\n    user: 'progress'\n  };\n}), _defineProperty(_createReducer, types.LOGIN_COMPLETED, function (state, action) {\n  var token = action.payload.id_token;\n\n  if (token) {\n    utils.saveJwtTokenOnTheStograte(action.payload.id_token);\n    var decodeToken = jwtDecode(token);\n    var roles = decodeToken.auth.trim().split(\",\");\n    var i = 0;\n\n    for (i = 0; i < roles.length; i++) {\n      if (roles[i] === \"ROLE_ADMIN\") {\n        history.push('/administrator/home');\n        break;\n      } else if (roles[i] === \"ROLE_TEACHER\") {\n        history.push('/teacher/home');\n        break;\n      } else if (roles[i] === \"ROLE_PARENTS\") {\n        history.push('/parents/home');\n        break;\n      } else if (roles[i] === \"ROLE_STUDENT\") {\n        history.push('/student/home');\n        break;\n      }\n    }\n\n    state = {\n      loggedIn: true,\n      user: action.payload.id_token\n    };\n  }\n\n  return state;\n}), _defineProperty(_createReducer, types.LOGIN_FAILED, function (state, action) {\n  state = {\n    loggedIn: false,\n    user: 'Login failed'\n  };\n  return state;\n}), _defineProperty(_createReducer, types.LOGOUT, function (state, action) {\n  localStorage.removeItem(\"user\");\n  history.push('/auth/login?logout=success');\n  return {};\n}), _createReducer));\nexport default combineReducers({\n  isAuthenticated: authReducer\n});",{"version":3,"sources":["E:\\QuanLyDaoTao\\Front-end\\src\\app\\state\\ducks\\session\\reducers.js"],"names":["combineReducers","types","utils","createReducer","history","jwtDecode","user","localStorage","getItem","initialState","loggedIn","authReducer","LOGIN","state","action","LOGIN_COMPLETED","token","payload","id_token","saveJwtTokenOnTheStograte","decodeToken","roles","auth","trim","split","i","length","push","LOGIN_FAILED","LOGOUT","removeItem","isAuthenticated"],"mappings":";;;;AAAA,SAASA,eAAT,QAAgC,OAAhC;AACA,OAAO,KAAKC,KAAZ,MAAuB,SAAvB;AACA,OAAO,KAAKC,KAAZ,MAAuB,SAAvB;AACA,SAASC,aAAT,QAA8B,aAA9B;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,IAAIC,IAAI,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX;AAEA,IAAMC,YAAY,GAAGH,IAAI,GAAG;AAAEI,EAAAA,QAAQ,EAAC,IAAX;AAAiBJ,EAAAA,IAAI,EAAJA;AAAjB,CAAH,GAA6B,EAAtD;AAEA,IAAMK,WAAW,GAAGR,aAAa,CAAEM,YAAF,CAAb,uDACdR,KAAK,CAACW,KADQ,EACC,UAAEC,KAAF,EAASC,MAAT,EAAqB;AAClC,SAAO;AACHJ,IAAAA,QAAQ,EAAE,KADP;AAEHJ,IAAAA,IAAI,EAAE;AAFH,GAAP;AAIH,CANe,mCAOdL,KAAK,CAACc,eAPQ,EAOW,UAAEF,KAAF,EAASC,MAAT,EAAqB;AAC5C,MAAME,KAAK,GAAGF,MAAM,CAACG,OAAP,CAAeC,QAA7B;;AACA,MAAIF,KAAJ,EAAW;AACPd,IAAAA,KAAK,CAACiB,yBAAN,CAAgCL,MAAM,CAACG,OAAP,CAAeC,QAA/C;AACA,QAAIE,WAAW,GAAGf,SAAS,CAACW,KAAD,CAA3B;AACA,QAAIK,KAAK,GAAGD,WAAW,CAACE,IAAZ,CAAiBC,IAAjB,GAAwBC,KAAxB,CAA8B,GAA9B,CAAZ;AACA,QAAIC,CAAC,GAAG,CAAR;;AACA,SAAKA,CAAC,GAAC,CAAP,EAAUA,CAAC,GAACJ,KAAK,CAACK,MAAlB,EAA0BD,CAAC,EAA3B,EAA+B;AAC3B,UAAIJ,KAAK,CAACI,CAAD,CAAL,KAAa,YAAjB,EAA+B;AAC3BrB,QAAAA,OAAO,CAACuB,IAAR,CAAa,qBAAb;AACA;AACH,OAHD,MAGO,IAAGN,KAAK,CAACI,CAAD,CAAL,KAAa,cAAhB,EAAgC;AACnCrB,QAAAA,OAAO,CAACuB,IAAR,CAAa,eAAb;AACA;AACH,OAHM,MAGA,IAAGN,KAAK,CAACI,CAAD,CAAL,KAAa,cAAhB,EAAgC;AACnCrB,QAAAA,OAAO,CAACuB,IAAR,CAAa,eAAb;AACA;AACH,OAHM,MAGA,IAAIN,KAAK,CAACI,CAAD,CAAL,KAAa,cAAjB,EAAiC;AACpCrB,QAAAA,OAAO,CAACuB,IAAR,CAAa,eAAb;AACA;AACH;AACJ;;AACDd,IAAAA,KAAK,GAAG;AACJH,MAAAA,QAAQ,EAAC,IADL;AAEJJ,MAAAA,IAAI,EAAEQ,MAAM,CAACG,OAAP,CAAeC;AAFjB,KAAR;AAIH;;AACD,SAAOL,KAAP;AACH,CAnCe,mCAoCdZ,KAAK,CAAC2B,YApCQ,EAoCQ,UAAEf,KAAF,EAASC,MAAT,EAAqB;AACzCD,EAAAA,KAAK,GAAG;AACJH,IAAAA,QAAQ,EAAE,KADN;AAEJJ,IAAAA,IAAI,EAAE;AAFF,GAAR;AAIA,SAAOO,KAAP;AACH,CA1Ce,mCA2CdZ,KAAK,CAAC4B,MA3CQ,EA2CE,UAAEhB,KAAF,EAASC,MAAT,EAAqB;AACnCP,EAAAA,YAAY,CAACuB,UAAb,CAAwB,MAAxB;AACA1B,EAAAA,OAAO,CAACuB,IAAR,CAAa,4BAAb;AACA,SAAO,EAAP;AACH,CA/Ce,mBAApB;AAkDA,eAAe3B,eAAe,CAAE;AAC5B+B,EAAAA,eAAe,EAAEpB;AADW,CAAF,CAA9B","sourcesContent":["import { combineReducers } from \"redux\";\r\nimport * as types from \"./types\";\r\nimport * as utils from './utils';\r\nimport { createReducer } from \"../../utils\";\r\nimport { history } from '../../utils';\r\nimport jwtDecode from 'jwt-decode';\r\n\r\nlet user = localStorage.getItem('user');\r\n\r\nconst initialState = user ? { loggedIn:true, user } : {};\r\n\r\nconst authReducer = createReducer( initialState )( {\r\n    [ types.LOGIN ]: ( state, action ) => {\r\n        return {\r\n            loggedIn: false,\r\n            user: 'progress'\r\n        };\r\n    },\r\n    [ types.LOGIN_COMPLETED ]: ( state, action ) => {\r\n        const token = action.payload.id_token;\r\n        if (token) {\r\n            utils.saveJwtTokenOnTheStograte(action.payload.id_token);\r\n            let decodeToken = jwtDecode(token);\r\n            let roles = decodeToken.auth.trim().split(\",\");\r\n            var i = 0;\r\n            for (i=0; i<roles.length; i++) {\r\n                if (roles[i] === \"ROLE_ADMIN\") {\r\n                    history.push('/administrator/home');\r\n                    break;\r\n                } else if(roles[i] === \"ROLE_TEACHER\") {\r\n                    history.push('/teacher/home');\r\n                    break;\r\n                } else if(roles[i] === \"ROLE_PARENTS\") {\r\n                    history.push('/parents/home');\r\n                    break;\r\n                } else if (roles[i] === \"ROLE_STUDENT\") {\r\n                    history.push('/student/home');\r\n                    break;\r\n                }\r\n            }\r\n            state = {\r\n                loggedIn:true, \r\n                user: action.payload.id_token\r\n            }\r\n        }\r\n        return state;\r\n    },\r\n    [ types.LOGIN_FAILED ]: ( state, action ) => {\r\n        state = {\r\n            loggedIn: false,\r\n            user: 'Login failed'\r\n        }\r\n        return state;\r\n    },\r\n    [ types.LOGOUT ]: ( state, action ) => {\r\n        localStorage.removeItem(\"user\");\r\n        history.push('/auth/login?logout=success');\r\n        return {};\r\n    }\r\n} );\r\n\r\nexport default combineReducers( {\r\n    isAuthenticated: authReducer\r\n} );"]}]}